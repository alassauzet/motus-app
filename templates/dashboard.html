{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="card">
    <h1>Bonjour {{ current_user.id }} !</h1>
    <p>Date du jour : {{ today.strftime('%d/%m/%Y') }}</p>
</div>

<div class="card">
    <h2>Ajouter vos points du jour</h2>
    <form method="post" style="display:flex; gap:0.5rem; flex-wrap:wrap;">
        <input type="number" name="attempts" min="0" placeholder="Nombre d'essais" required style="flex:1;">
        <button type="submit">Soumettre</button>
    </form>
</div>

<div class="card">
    <h2>Classement du mois</h2>
    <table>
        <thead>
            <tr><th>#</th><th>Utilisateur</th><th>Points</th></tr>
        </thead>
        <tbody>
            {% for i, row in enumerate(leaderboard) %}
            <tr>
                <td>{{ i+1 }}</td>
                <td>{{ row.username }}</td>
                <td>{{ row.points }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Ã‰volution quotidienne</h2>
    <canvas id="chart" style="width:100%; height:300px;"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('chart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: {{ labels|tojson }},
        datasets: [{
            label: 'Points',
            data: {{ values|tojson }},
            borderColor: '#6366f1',
            backgroundColor: 'rgba(99,102,241,0.2)',
            tension: 0.3
        }]
    },
    options: { responsive:true, scales:{ y:{ beginAtZero:true } } }
});
</script>
{% endblock %}
